AWSTemplateFormatVersion: '2010-09-09'
Description: CloudFormation template for bootstrapping the admin role in your AWS account.

Parameters:
  GiantSwarmUserAccount:
    Type: String
    Description: "Account of Giant Swarm IAM users (`084190472784`, except for China). Assumed to be in the same partition as the CloudFormation stack account (`aws`, or `aws-cn` for China)."
    Default: "084190472784"
    # No `AllowedValues` here, since we don't publish the identifiers of other accounts
    AllowedPattern: "^[0-9]{12}$"

Resources:
  GiantSwarmAdminRole:
    Type: "AWS::IAM::Role"
    Properties:
      RoleName: GiantSwarmAdmin
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: "Allow"
            Principal:
              AWS: !Sub "arn:${AWS::Partition}:iam::${GiantSwarmUserAccount}:root"
            Action: "sts:AssumeRole"

  GiantSwarmAdminPolicy:
    Type: "AWS::IAM::Policy"
    Properties:
      PolicyName: "GiantSwarmAdmin"
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: "Allow"
            Action:
              - "acm:*"
              - "autoscaling:*"
              - "cloudformation:*"
              - "cloudfront:*"
              - "cloudwatch:*"
              - "dynamodb:*"
              - "ec2:*"
              - "ecr:*"
              - "elasticfilesystem:*"
              - "elasticloadbalancing:*"
              - "events:*"
              - "ram:*"
              - "iam:AddRoleToInstanceProfile"
              - "iam:AttachRolePolicy"
              - "iam:CreateAccessKey"
              - "iam:CreateInstanceProfile"
              - "iam:CreatePolicy"
              - "iam:CreatePolicyVersion"
              - "iam:CreateRole"
              - "iam:CreateServiceLinkedRole"
              - "iam:DeleteAccessKey"
              - "iam:DeleteInstanceProfile"
              - "iam:DeletePolicy"
              - "iam:DeletePolicyVersion"
              - "iam:DeleteRole"
              - "iam:DeleteRolePolicy"
              - "iam:DeleteServiceLinkedRole"
              - "iam:DetachRolePolicy"
              - "iam:GenerateServiceLastAccessedDetails"
              - "iam:Get*"
              - "iam:List*"
              - "iam:PassRole"
              - "iam:PutRolePolicy"
              - "iam:RemoveRoleFromInstanceProfile"
              - "iam:TagPolicy"
              - "iam:TagRole"
              - "iam:UpdateAccessKey"
              - "iam:UpdateAssumeRolePolicy"
              - "iam:UpdateRoleDescription"
              - "kms:*"
              - "logs:*"
              - "route53:*"
              - "route53domains:*"
              - "route53resolver:*"
              - "s3:*"
              - "sts:AssumeRole"
              - "sts:DecodeAuthorizationMessage"
              - "sts:GetFederationToken"
              - "support:*"
              - "trustedadvisor:*"
              - "sqs:*"
              - "iam:CreateOpenIDConnectProvider"
              - "iam:DeleteOpenIDConnectProvider"
              - "iam:TagOpenIDConnectProvider"
              - "iam:UntagOpenIDConnectProvider"
              - "iam:UpdateOpenIDConnectProviderThumbprint"
              - "iam:RemoveClientIDFromOpenIDConnectProvider"
              - "iam:AddClientIDToOpenIDConnectProvider"
            Resource: "*"
      Roles:
        - !Ref GiantSwarmAdminRole

Outputs:
  GiantSwarmAdminRoleArn:
    Description: "The ARN of the IAM role"
    Value: !GetAtt GiantSwarmAdminRole.Arn
